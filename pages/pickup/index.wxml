<!-- pages/pickup/index.wxml -->
<view class="pickup-page">
  <scroll-view class="scroll-area" scroll-y>
  <!-- 收货地址选择（先选地址） -->
    <view class="card">
      <view class="card-title">收货地址</view>
      <view class="address-list" wx:if="{{deliveryAddressList.length > 0}}">
        <view 
        class="address-item {{selectedAddressId === item.id ? 'selected' : ''}}" 
          wx:for="{{deliveryAddressList}}" 
          wx:key="id"
          bindtap="selectDeliveryAddress" 
          data-id="{{item.id}}">
          <view class="address-content">
            <view class="address-line">
              <text class="contact-name">{{item.contactName}}</text>
              <text class="contact-phone">{{item.contactPhone}}</text>
            </view>
            <view class="address-detail">
              {{item.province}}{{item.city}}{{item.district}}{{item.street}} {{item.detailAddress}}
            </view>
          <view class="address-tags" wx:if="{{item.isDefault}}">
            <text class="tag default">默认</text>
          </view>
          </view>
        <view class="address-check" wx:if="{{selectedAddressId === item.id}}">✓</view>
        </view>
      </view>
      <view class="empty-tip" wx:else>
      <text>暂无地址，请先添加收货地址</text>
      </view>
    </view>

    <!-- 取件驿站选择（地址选定后加载） -->
    <view class="card">
      <view class="card-title">取件驿站</view>
      <picker mode="selector" range="{{stationNames}}" value="{{selectedStationIndex}}" bindchange="onStationChange">
        <view class="picker-field {{!selectedAddressId ? 'disabled' : ''}}">
          <text wx:if="{{stationNames.length > 0 && selectedStationIndex >= 0}}">{{stationNames[selectedStationIndex]}}</text>
          <text wx:else class="placeholder-text">{{ selectedAddressId ? '请选择取件驿站' : '请先选择收货地址' }}</text>
        </view>
      </picker>
      <view class="card-tip" wx:if="{{selectedAddressId && stationNames.length === 0}}">该地址附近暂无可服务驿站</view>
    </view>

    <!-- 包裹信息 -->
    <view class="card">
      <view class="card-title">包裹信息</view>
      
      <!-- 取件手机尾号 -->
      <view class="form-item">
        <view class="label required">取件手机号后四位</view>
        <input class="input" type="number" maxlength="4" placeholder="请输入后四位" value="{{form.phoneTail}}" bindinput="onInputPhoneTail" />
      </view>

      <!-- 取件码 -->
      <view class="form-item">
        <view class="label">取件码（可选）</view>
        <textarea class="textarea pick-codes-textarea" placeholder="可填写多个，用逗号分隔" value="{{form.pickCodesStr}}" bindinput="onInputPickCodes" maxlength="200"></textarea>
      </view>

      <!-- 取件照片 -->
      <view class="form-item">
        <view class="label">取件照片（可选）</view>
        <view class="pic-list">
          <view class="pic-item" wx:for="{{form.pickPics}}" wx:key="index">
            <image class="pic-image" src="{{item}}" mode="aspectFill"></image>
            <view class="pic-delete" bindtap="deletePickPic" data-index="{{index}}">×</view>
          </view>
          <view class="pic-add" wx:if="{{form.pickPics.length < 9}}" bindtap="choosePickPics">
            <text class="pic-add-icon">+</text>
            <text class="pic-add-text">添加照片</text>
          </view>
        </view>
      </view>

      <!-- 物品备注 -->
      <view class="form-item">
        <view class="label required">物品备注</view>
        <textarea class="textarea item-remark-textarea" placeholder="请填写物品相关信息，如：2件小箱子" value="{{form.itemDescription}}" bindinput="onInputItemRemark" maxlength="500"></textarea>
        
        <!-- 快捷选项 -->
        <view class="quick-options">
          <view class="quick-option-item" wx:for="{{quickOptions}}" wx:key="index" bindtap="addQuickOption" data-text="{{item}}">
            <text>{{item}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 送达时间范围 -->
    <view class="card">
      <view class="card-title">送达时间范围</view>
      
      <view class="time-selector-row">
        <!-- 日期选择 -->
        <view class="time-selector-item">
          <view class="label required">日期</view>
          <picker mode="selector" range="{{dateOptions}}" range-key="label" value="{{selectedDateIndex}}" bindchange="onDateChange">
            <view class="picker-field">
              <text wx:if="{{selectedDateIndex >= 0}}">{{dateOptions[selectedDateIndex].label}}</text>
              <text wx:else class="placeholder-text">请选择日期</text>
            </view>
          </picker>
        </view>

        <!-- 时间段选择 -->
        <view class="time-selector-item">
          <view class="label required">时间段</view>
          <picker mode="selector" range="{{timeSlotOptions}}" range-key="label" value="{{selectedTimeSlotIndex}}" bindchange="onTimeSlotChange">
            <view class="picker-field">
              <text wx:if="{{selectedTimeSlotIndex >= 0}}">{{timeSlotOptions[selectedTimeSlotIndex].label}}</text>
              <text wx:else class="placeholder-text">请选择时间段</text>
            </view>
          </picker>
        </view>
      </view>
      
      <!-- 显示选择的时间 -->
      <view class="selected-time-display" wx:if="{{form.startTimeStr}}">
        <text class="selected-time-text">{{form.startTimeStr}}</text>
      </view>
    </view>
  </scroll-view>

  <!-- 底部提交按钮 -->
  <view class="bottom-bar">
    <button class="submit-btn" bindtap="onSubmit">提交订单</button>
  </view>
</view>
