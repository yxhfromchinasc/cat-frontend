<!-- pages/recycle/index.wxml -->
<view class="recycle-page">
  <scroll-view class="scroll-area" scroll-y>
    <!-- 收货地址选择 -->
    <view class="card">
      <view class="card-title">收货地址</view>
      <!-- 有默认地址时显示 -->
      <view class="address-single" wx:if="{{defaultAddress}}" bindtap="selectDeliveryAddress">
        <view class="address-content">
          <view class="address-line">
            <text class="contact-name">{{defaultAddress.contactName}}</text>
            <text class="contact-phone">{{defaultAddress.contactPhone}}</text>
            <text class="tag default">默认</text>
          </view>
          <view class="address-detail">
            {{defaultAddress.province}}{{defaultAddress.city}}{{defaultAddress.district}}{{defaultAddress.street}} {{defaultAddress.detailAddress}}
          </view>
        </view>
        <view class="address-arrow">›</view>
      </view>
      <!-- 没有地址时显示添加按钮 -->
      <view class="address-empty" wx:else bindtap="selectDeliveryAddress">
        <text class="empty-text">去添加地址</text>
        <view class="address-arrow">›</view>
      </view>
      
      <!-- 回收点提示 -->
      <view class="recycling-point-tip" wx:if="{{selectedAddressId}}">
        <text class="tip-text success" wx:if="{{recyclingPointName}}">{{recyclingPointName}}将为您服务</text>
        <text class="tip-text error" wx:else>该地址不在服务范围内</text>
      </view>
    </view>

    <!-- 回收信息 -->
    <view class="card">
      <view class="card-title">回收信息</view>
      
      <!-- 拍照留念（选填） -->
      <view class="form-item">
        <view class="label">拍照留念（选填）</view>
        <view class="image-upload-container">
          <view class="image-list">
            <view class="image-item" wx:for="{{form.images}}" wx:key="index">
              <image class="uploaded-image" src="{{item}}" mode="aspectFill" bindtap="previewImage" data-url="{{item}}" data-index="{{index}}"></image>
              <view class="delete-image-btn" bindtap="deleteImage" data-index="{{index}}">×</view>
            </view>
            <view class="upload-btn" wx:if="{{form.images.length < 9}}" bindtap="chooseImages">
              <text class="upload-icon">+</text>
              <text class="upload-text">添加照片</text>
            </view>
          </view>
          <view class="upload-tip">最多可上传9张照片</view>
        </view>
      </view>
    </view>

    <!-- 上门时间 -->
    <view class="card">
      <view class="card-title">上门时间</view>
      
      <!-- 是否加急开关 -->
      <view class="form-item checkbox-item">
        <view class="label">立即上门</view>
        <switch checked="{{timeType === 'immediate'}}" bindchange="onImmediateSwitchChange" color="#07c160" />
      </view>
      
      <!-- 立即上门：显示时间范围 -->
      <view class="immediate-time-display" wx:if="{{timeType === 'immediate' && form.startTimeStr}}">
        <text class="selected-time-text">{{form.startTimeStr}}</text>
      </view>
      
      <!-- 预约时间：显示日期和时间选择器 -->
      <view wx:if="{{timeType === 'appointment'}}">
        <view class="time-selector-row">
          <!-- 日期选择 -->
          <view class="time-selector-item">
            <view class="label required">日期</view>
            <picker mode="selector" range="{{dateOptions}}" range-key="label" value="{{selectedDateIndex}}" bindchange="onDateChange">
              <view class="picker-field">
                <text wx:if="{{selectedDateIndex >= 0}}">{{dateOptions[selectedDateIndex].label}}</text>
                <text wx:else class="placeholder-text">请选择日期</text>
              </view>
            </picker>
          </view>
          
          <!-- 时间段选择 -->
          <view class="time-selector-item">
            <view class="label required">时间</view>
            <picker mode="selector" range="{{timeSlotOptions}}" range-key="label" value="{{selectedTimeSlotIndex}}" bindchange="onTimeSlotChange">
              <view class="picker-field {{selectedTimeSlotIndex >= 0 && timeSlotOptions[selectedTimeSlotIndex].disabled ? 'disabled' : ''}}">
                <text wx:if="{{selectedTimeSlotIndex >= 0}}" class="{{timeSlotOptions[selectedTimeSlotIndex].disabled ? 'disabled-text' : ''}}">{{timeSlotOptions[selectedTimeSlotIndex].label}}</text>
                <text wx:else class="placeholder-text">请选择时间</text>
              </view>
            </picker>
          </view>
        </view>
        
        <!-- 显示选中的时间范围 -->
        <view class="selected-time-display" wx:if="{{form.startTimeStr}}">
          <text class="selected-time-text">{{form.startTimeStr}}</text>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- 提交按钮 -->
  <view class="submit-bar">
    <button class="submit-btn" bindtap="submitOrder" disabled="{{!canSubmitData}}">提交订单</button>
  </view>
</view>
