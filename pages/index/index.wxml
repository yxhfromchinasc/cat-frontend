<!--index.wxml-->
<scroll-view class="scrollarea" scroll-y type="list">
  <view class="index-container">
    <!-- 头部区域：小程序图标和信息 -->
    <view class="header-section">
      <view class="header-content">
        <view class="logo-container">
          <image class="app-logo" src="/assets/tabbar/logo.svg" mode="aspectFit"></image>
        </view>
        <view class="app-info">
          <view class="app-name">喵上门</view>
          <view class="login-status" bindtap="goToPhoneLogin" wx:if="{{!isLogin}}">
            <text>暂未登录,点击登录>></text>
          </view>
          <view class="user-info-header" wx:if="{{isLogin}}">
            <text>{{userInfo ? userInfo.name : '用户'}}</text>
          </view>
        </view>
        
        <!-- 消息入口 -->
        <view class="message-entry" bindtap="goToProfile">
          <image class="message-icon" src="/assets/tabbar/会话框-白色.svg" mode="aspectFit"></image>
          <view class="message-badge" wx:if="{{unreadMessageCount > 0}}">{{unreadMessageCount > 99 ? '99+' : unreadMessageCount}}</view>
        </view>
      </view>
    </view>

    <!-- 顶部：业务入口双卡片 -->
    <view class="biz-section">
      <view class="biz-grid">
        <!-- 第一行：上门回收 + 提现教程 -->
        <view class="biz-row">
          <view class="biz-card biz-card-recycle" bindtap="goToRecycle">
            <view class="biz-card-content">
              <view class="biz-card-left">
                <view class="biz-title">上门回收</view>
                <view class="biz-recycle-btn">再少也收</view>
              </view>
              <view class="biz-card-right">
                <image class="biz-card-image" src="/assets/tabbar/货车卡车汽车.png" mode="aspectFit"></image>
              </view>
            </view>
          </view>
          <view class="small-card small-card-withdraw" bindtap="onSmallCardTap" data-type="withdraw">
            <image class="small-card-image" src="/assets/tabbar/提现 (1).png" mode="aspectFit"></image>
            <view class="small-card-title">提现教程</view>
          </view>
        </view>
        
        <!-- 第二行：服务介绍 + 快递代取 -->
        <view class="biz-row">
          <view class="small-card small-card-service" bindtap="onSmallCardTap" data-type="service">
            <image class="small-card-image" src="/assets/tabbar/介绍.png" mode="aspectFit"></image>
            <view class="small-card-title">服务介绍</view>
          </view>
          <view class="biz-card biz-card-pickup" bindtap="goToPickup">
            <view class="biz-card-content">
              <view class="biz-card-left">
                <view class="biz-title">快递代取</view>
                <view class="biz-pickup-btn">先用后付</view>
              </view>
              <view class="biz-card-right">
                <image class="biz-card-image" src="/assets/tabbar/首页_快递.png" mode="aspectFit"></image>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 邀请好友链接 -->
    <view class="service-point-link" bindtap="goToInvite">
      <text>邀请好友得奖励>></text>
    </view>

    <!-- 下方：竖版卡片区域 -->
    <view class="vertical-card-section">
      <view class="vertical-card-row">
        <view class="vertical-card" bindtap="goToRecycleGuide">
          <view class="vertical-card-content">
            <image class="vertical-card-image" src="/assets/tabbar/玻璃垃圾.png" mode="aspectFit"></image>
            <view class="vertical-card-title-wrapper">
              <view class="vertical-card-title">可回收物</view>
              <view class="vertical-card-subtitle">分类小科普</view>
              <view class="vertical-card-arrow">>></view>
            </view>
          </view>
        </view>
        <view class="vertical-card" bindtap="goToActivity" wx:if="{{showActivityCard}}">
          <view class="vertical-card-content">
            <image class="vertical-card-image" src="{{activityConfig.iconUrl}}" mode="aspectFit"></image>
            <view class="vertical-card-title-wrapper">
              <view class="vertical-card-title" wx:if="{{activityConfig.descriptions[0]}}">{{activityConfig.descriptions[0]}}</view>
              <view class="vertical-card-subtitle" wx:if="{{activityConfig.descriptions[1]}}">{{activityConfig.descriptions[1]}}</view>
              <view class="vertical-card-arrow">>></view>
            </view>
          </view>
        </view>
        <!-- 如果没有配置活动，显示原来的邀请奖励卡片 -->
        <view class="vertical-card" bindtap="goToInviteReward" wx:else>
          <view class="vertical-card-content">
            <image class="vertical-card-image" src="/assets/tabbar/现金.png" mode="aspectFit"></image>
            <view class="vertical-card-title-wrapper">
              <view class="vertical-card-title">邀请奖励</view>
              <view class="vertical-card-subtitle">拉新得现金</view>
              <view class="vertical-card-arrow">>></view>
            </view>
          </view>
        </view>
      </view>
    </view>

    
  </view>
</scroll-view>

<!-- 登录弹窗 -->
<view class="login-modal" wx:if="{{showLoginModal}}" bindtap="closeLoginModal">
  <view class="login-popup" catchtap="">
    <view class="login-header">
      <text class="login-title">登录</text>
      <text class="close-btn" bindtap="closeLoginModal">×</text>
    </view>
    
    <view class="login-content">
      <button class="wechat-login-btn" hover-class="wechat-login-btn-hover" hover-start-time="0" hover-stay-time="70" bindtap="wechatLogin">
        快捷登录
      </button>
      
      <button class="phone-login-btn" hover-class="phone-login-btn-hover" hover-start-time="0" hover-stay-time="70" bindtap="goToPhoneLogin">
        手机号登录
      </button>
    </view>
  </view>
</view>

<!-- 公告弹窗 -->
<view id="announcement-modal" class="announcement-modal" wx:if="{{showAnnouncementModal}}" bindtap="closeAnnouncementModal">
  <view class="announcement-popup" catchtap="stopPropagation">
    <!-- 标题区域（如果有标题） -->
    <view 
      wx:if="{{announcementData.title}}" 
      class="announcement-title"
      bindtap="onAnnouncementTap"
    >
      {{announcementData.title}}
    </view>
    
    <!-- 图片区域（如果有图片） -->
    <image 
      wx:if="{{announcementData.imageUrl}}" 
      class="announcement-image {{announcementData.title ? 'announcement-image-with-title' : 'announcement-image-without-title'}}" 
      src="{{announcementData.imageUrl}}" 
      mode="widthFix"
      style="{{announcementData.imageHeight ? 'height: ' + announcementData.imageHeight + 'px;' : ''}}"
      bindtap="onAnnouncementTap"
    ></image>
    
    <!-- 文字内容区域（如果有文字） -->
    <view 
      wx:if="{{announcementData.textContent}}" 
      class="announcement-text"
      style="font-size: {{announcementData.textFontSize || 16}}px; color: {{announcementData.textFontColor || '#000000'}};"
      bindtap="onAnnouncementTap"
    >
      {{announcementData.textContent}}
    </view>
    
    <!-- 底部按钮区域 -->
    <view class="announcement-footer">
      <view class="announcement-footer-left" catchtap="stopPropagation" wx:if="{{isLogin}}">
        <checkbox-group bindchange="onHideCheckboxChange">
          <view class="announcement-checkbox-wrapper">
            <checkbox class="announcement-checkbox" value="hide" checked="{{hideTodayChecked}}" />
            <text class="announcement-checkbox-text">今天不再展示</text>
          </view>
        </checkbox-group>
      </view>
      <view class="announcement-close-btn {{isCloseBtnLoading ? 'announcement-close-btn-loading' : ''}}" bindtap="closeAnnouncementModal">
        <view wx:if="{{isCloseBtnLoading}}" class="announcement-close-btn-loading-icon"></view>
        <text>{{isCloseBtnLoading ? '加载中' : '关闭'}}</text>
      </view>
    </view>
  </view>
</view>
