<view class="coupon-page">
  <!-- é¡¶éƒ¨æ ‡ç­¾æ  -->
  <view class="tab-bar">
    <view class="tab-item {{currentTab === 0 ? 'active' : ''}}" bindtap="switchTab" data-index="0">
      <text>æˆ‘çš„å¡åˆ¸</text>
    </view>
    <view class="tab-item {{currentTab === 1 ? 'active' : ''}}" bindtap="switchTab" data-index="1">
      <text>å¯é¢†å–</text>
    </view>
  </view>

  <!-- æˆ‘çš„å¡åˆ¸ -->
  <view class="tab-content" wx:if="{{currentTab === 0}}">
    <!-- çŠ¶æ€ç­›é€‰ -->
    <view class="status-filter">
      <view class="filter-item {{couponStatus === 1 ? 'active' : ''}}" bindtap="filterCoupons" data-status="1">
        <text>æœªä½¿ç”¨</text>
      </view>
      <view class="filter-item {{couponStatus === 2 ? 'active' : ''}}" bindtap="filterCoupons" data-status="2">
        <text>å·²ä½¿ç”¨</text>
      </view>
      <view class="filter-item {{couponStatus === 3 ? 'active' : ''}}" bindtap="filterCoupons" data-status="3">
        <text>å·²è¿‡æœŸ</text>
      </view>
    </view>

    <!-- å¡åˆ¸åˆ—è¡¨ -->
    <scroll-view class="coupon-list" scroll-y="{{true}}" lower-threshold="50" enable-flex="{{true}}">
      <block wx:if="{{userCoupons.length > 0}}">
        <view class="coupon-item" wx:for="{{userCoupons}}" wx:key="id">
          <view class="coupon-card {{item.cardClass}}">
            <view class="coupon-body">
              <view class="coupon-main">
                <view class="coupon-value-section">
                  <view class="value-wrapper">
                    <text class="value-symbol">{{item.valuePrefix}}</text>
                    <text class="value-amount">{{item.valueDisplay}}</text>
                  </view>
                </view>
                <view class="coupon-info">
                  <view class="coupon-header-row">
                    <view class="coupon-type-tag">{{item.typeText}}</view>
                    <view class="coupon-name">{{item.name}}</view>
                    <view class="coupon-status-tag">{{item.statusText}}</view>
                  </view>
                  <view class="coupon-meta-row">
                    <text class="coupon-condition" wx:if="{{item.conditionText}}">{{item.conditionText}}</text>
                    <text wx:if="{{item.extraText}}" class="extra-text">{{item.extraText}}</text>
                    <text class="coupon-time">æœ‰æ•ˆæœŸè‡³ï¼š{{item.expiredText}}</text>
                  </view>
                  <view class="coupon-desc" wx:if="{{item.description}}">
                    <text>{{item.description}}</text>
                  </view>
                </view>
              </view>
            </view>
          </view>
        </view>
      </block>
      
      <view class="empty-state" wx:else>
        <text class="empty-icon">ğŸ«</text>
        <text class="empty-text">æš‚æ— å¡åˆ¸</text>
        <text class="empty-desc">å¿«å»é¢†å–ä¼˜æƒ åˆ¸å§</text>
      </view>
    </scroll-view>
  </view>

  <!-- å¯é¢†å– -->
  <view class="tab-content" wx:if="{{currentTab === 1}}">
    <scroll-view class="coupon-list" scroll-y="{{true}}" lower-threshold="50" enable-flex="{{true}}">
      <block wx:if="{{couponTemplates.length > 0}}">
        <view class="coupon-item" wx:for="{{couponTemplates}}" wx:key="id">
          <view class="coupon-card {{item.cardClass}}">
            <view class="coupon-body">
              <view class="coupon-main">
                <view class="coupon-value-section">
                  <view class="value-wrapper">
                    <text class="value-symbol">{{item.valuePrefix}}</text>
                    <text class="value-amount">{{item.valueDisplay}}</text>
                  </view>
                </view>
                <view class="coupon-info">
                  <view class="coupon-header-row">
                    <view class="coupon-type-tag">{{item.typeText}}</view>
                    <view class="coupon-name">{{item.name}}</view>
                  </view>
                  <view class="coupon-meta-row">
                    <text class="coupon-condition" wx:if="{{item.conditionText}}">{{item.conditionText}}</text>
                    <text wx:if="{{item.extraText}}" class="extra-text">{{item.extraText}}</text>
                    <text class="coupon-time">é¢†å–åæœ‰æ•ˆæœŸï¼š{{item.validDaysAfterReceive || 0}}å¤©</text>
                  </view>
                  <view class="coupon-desc" wx:if="{{item.description}}">
                    <text>{{item.description}}</text>
                  </view>
                  <view class="coupon-action">
                    <button class="receive-btn" bindtap="receiveCoupon" data-id="{{item.id}}" disabled="{{item.buttonDisabled}}">
                      {{item.buttonText}}
                    </button>
                  </view>
                </view>
              </view>
            </view>
          </view>
        </view>
      </block>
      
      <view class="empty-state" wx:else>
        <text class="empty-icon">ğŸ</text>
        <text class="empty-text">æš‚æ— å¯é¢†å–çš„å¡åˆ¸</text>
        <text class="empty-desc">æ•¬è¯·æœŸå¾…æ›´å¤šä¼˜æƒ </text>
      </view>
    </scroll-view>
  </view>
</view>
