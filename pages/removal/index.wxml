<!-- pages/removal/index.wxml 大件清运发起页，布局与组件参考快递代取 -->
<view class="removal-page">
  <scroll-view class="scroll-area" scroll-y>
    <!-- 收货地址选择（与回收页一致：地址 + 清运点提示同卡） -->
    <view class="card">
      <view class="address-single" wx:if="{{defaultAddress}}" bindtap="selectAddress">
        <view class="address-icon">
          <image class="location-icon" src="/assets/tabbar/地址-start.png" mode="aspectFit"></image>
        </view>
        <view class="address-content">
          <view class="address-line">
            <text class="contact-name">{{defaultAddress.contactName}}</text>
            <text class="contact-phone">{{defaultAddress.contactPhone}}</text>
          </view>
          <view class="address-detail">
            {{defaultAddress.province}}{{defaultAddress.city}}{{defaultAddress.district}}{{defaultAddress.street}} {{defaultAddress.detailAddress}}
          </view>
        </view>
        <view class="address-arrow">›</view>
      </view>
      <view class="address-empty" wx:else bindtap="selectAddress">
        <text class="empty-text">去添加地址</text>
        <view class="address-arrow">›</view>
      </view>
      <!-- 清运点提示（与回收页回收点提示一致） -->
      <view class="recycling-point-tip" wx:if="{{selectedAddressId}}">
        <text class="tip-text success" wx:if="{{removalPointName}}">{{removalPointName}}将为您服务</text>
        <text class="tip-text error" wx:else>该地址不在服务范围内</text>
      </view>
    </view>

    <!-- 预约时间（大件清运：前端不再提供“是否加急”选择，行为与回收业务一致） -->
    <view class="card time-card">
      <view class="appointment-time-selector" bindtap="showTimePicker">
        <view class="time-icon">
          <image class="clock-icon" src="/assets/tabbar/预约.png" mode="aspectFit"></image>
        </view>
        <view class="time-content">
          <view class="time-title">预约时间段</view>
          <view class="time-placeholder">{{form.startTimeStr || '请选择预约时间'}}</view>
        </view>
        <view class="time-arrow">›</view>
      </view>
    </view>

    <!-- 清运信息 -->
    <view class="card">
      <view class="card-title">清运信息</view>

      <!-- 清运类型：按钮选择 -->
      <view class="form-item">
        <view class="label">清运类型</view>
        <view class="category-btns">
          <view
            class="category-btn {{form.serviceCategory === 1 ? 'category-btn-active' : ''}}"
            bindtap="onServiceCategoryTap"
            data-value="1"
          >报废清除</view>
          <view
            class="category-btn {{form.serviceCategory === 2 ? 'category-btn-active' : ''}}"
            bindtap="onServiceCategoryTap"
            data-value="2"
          >屋内搬运</view>
        </view>
      </view>

      <!-- 现场照片（必填） -->
      <view class="form-item">
        <view class="label required">现场照片</view>
        <view class="image-upload-container">
          <view class="image-list">
            <view class="image-item" wx:for="{{form.images}}" wx:key="index">
              <image class="uploaded-image" src="{{item}}" mode="aspectFill" bindtap="previewImage" data-url="{{item}}" data-index="{{index}}"></image>
              <view class="delete-image-btn" bindtap="deleteImage" data-index="{{index}}">×</view>
            </view>
            <view class="upload-btn" wx:if="{{form.images.length < 9}}" bindtap="chooseImages">
              <image class="upload-placeholder-icon" src="/assets/tabbar/图片占位符.png" mode="aspectFit"></image>
            </view>
          </view>
        </view>
      </view>

      <!-- 备注 -->
      <view class="form-item">
        <view class="label">备注（选填）</view>
        <textarea class="textarea item-remark-textarea" placeholder="请填写大件物品描述、楼层等" value="{{form.remark}}" bindinput="onRemarkInput" maxlength="500"></textarea>
      </view>
    </view>

    <!-- 提交 -->
    <view class="card submit-card">
      <view class="submit-tip" wx:if="{{submitTip}}">{{submitTip}}</view>
      <button class="submit-btn" bindtap="submitOrder" disabled="{{!canSubmitData || isSubmitting || showTimePickerModal}}">{{isSubmitting ? '提交中...' : '提交订单'}}</button>
    </view>

    <view class="safe-area-bottom"></view>

    <!-- 时间选择器（与回收/快递代取共用组件） -->
    <time-picker-modal
      visible="{{showTimePickerModal}}"
      dateOptions="{{dateOptions}}"
      timeSlotOptions="{{timeSlotOptions}}"
      selectedDateIndex="{{selectedDateIndex}}"
      selectedTimeSlotIndex="{{selectedTimeSlotIndex}}"
      bind:close="hideTimePicker"
      bind:selectdate="selectDate"
      bind:selecttimeslot="selectTimeSlot"
      bind:confirm="confirmTimeSelection"
    />
  </scroll-view>
</view>
